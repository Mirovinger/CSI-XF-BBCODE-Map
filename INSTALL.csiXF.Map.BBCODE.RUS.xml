<?xml version="1.0" encoding="utf-8"?>
<!--
  Copyright © 2015 CYBERSPACE.Industries
  Contacts: http://cyberspace.industries/
  License: LICENSE.ENG.txt / LICENSE.RUS.txt
-->
<addon addon_id="csiXF_bbCodeMap" title="(CSI/XF/BBCODE) Карта" version_string="1.0.1" version_id="2" url="http://cyberspace.industries/" install_callback_class="" install_callback_method="" uninstall_callback_class="" uninstall_callback_method="">
  <admin_navigation/>
  <admin_permissions/>
  <admin_style_properties/>
  <admin_templates/>
  <admin_template_modifications/>
  <code_events/>
  <code_event_listeners/>
  <cron/>
  <email_templates/>
  <email_template_modifications/>
  <optiongroups>
    <group group_id="csiXF_bbCodeMap" display_order="99999999" debug_only="0"/>
    <option option_id="csiXF_bbCodeMap_layers" edit_format="textbox" data_type="string" can_backup="1">
      <default_value><![CDATA['OpenStreetMap']]></default_value>
      <edit_format_params>rows=5</edit_format_params>
      <sub_options></sub_options>
      <relation group_id="csiXF_bbCodeMap" display_order="1"/>
    </option>
    <option option_id="csiXF_bbCodeMap_layerBing" edit_format="onoff" data_type="boolean" can_backup="1">
      <default_value>0</default_value>
      <edit_format_params></edit_format_params>
      <sub_options></sub_options>
      <relation group_id="csiXF_bbCodeMap" display_order="101"/>
    </option>
    <option option_id="csiXF_bbCodeMap_layerEsri" edit_format="onoff" data_type="boolean" can_backup="1">
      <default_value>0</default_value>
      <edit_format_params></edit_format_params>
      <sub_options></sub_options>
      <relation group_id="csiXF_bbCodeMap" display_order="102"/>
    </option>
    <option option_id="csiXF_bbCodeMap_layerGoogle" edit_format="onoff" data_type="boolean" can_backup="1">
      <default_value>1</default_value>
      <edit_format_params></edit_format_params>
      <sub_options></sub_options>
      <relation group_id="csiXF_bbCodeMap" display_order="103"/>
    </option>
    <option option_id="csiXF_bbCodeMap_layerYandex" edit_format="onoff" data_type="boolean" can_backup="1">
      <default_value>1</default_value>
      <edit_format_params></edit_format_params>
      <sub_options></sub_options>
      <relation group_id="csiXF_bbCodeMap" display_order="104"/>
    </option>
    <option option_id="csiXF_bbCodeMap_layer2GIS" edit_format="onoff" data_type="boolean" can_backup="1">
      <default_value>1</default_value>
      <edit_format_params></edit_format_params>
      <sub_options></sub_options>
      <relation group_id="csiXF_bbCodeMap" display_order="105"/>
    </option>
    <option option_id="csiXF_bbCodeMap_layerNokia" edit_format="onoff" data_type="boolean" can_backup="1">
      <default_value>0</default_value>
      <edit_format_params></edit_format_params>
      <sub_options></sub_options>
      <relation group_id="csiXF_bbCodeMap" display_order="106"/>
    </option>
    <option option_id="csiXF_bbCodeMap_defaultZoom" edit_format="spinbox" data_type="string" can_backup="1">
      <default_value>2</default_value>
      <edit_format_params></edit_format_params>
      <sub_options></sub_options>
      <relation group_id="csiXF_bbCodeMap" display_order="201"/>
    </option>
    <option option_id="csiXF_bbCodeMap_defaultPosition" edit_format="textbox" data_type="string" can_backup="1">
      <default_value><![CDATA[22, 11]]></default_value>
      <edit_format_params></edit_format_params>
      <sub_options></sub_options>
      <relation group_id="csiXF_bbCodeMap" display_order="202"/>
    </option>
    <option option_id="csiXF_bbCodeMap_viewWidth" edit_format="spinbox" data_type="string" can_backup="1">
      <default_value>600</default_value>
      <edit_format_params></edit_format_params>
      <sub_options></sub_options>
      <relation group_id="csiXF_bbCodeMap" display_order="203"/>
    </option>
    <option option_id="csiXF_bbCodeMap_viewHeight" edit_format="spinbox" data_type="string" can_backup="1">
      <default_value>300</default_value>
      <edit_format_params></edit_format_params>
      <sub_options></sub_options>
      <relation group_id="csiXF_bbCodeMap" display_order="204"/>
    </option>
    <option option_id="csiXF_bbCodeMap_fullViewHeight" edit_format="spinbox" data_type="string" can_backup="1">
      <default_value>600</default_value>
      <edit_format_params></edit_format_params>
      <sub_options></sub_options>
      <relation group_id="csiXF_bbCodeMap" display_order="205"/>
    </option>
    <option option_id="csiXF_bbCodeMap_fullFromStart" edit_format="onoff" data_type="boolean" can_backup="1">
      <default_value>1</default_value>
      <edit_format_params></edit_format_params>
      <sub_options></sub_options>
      <relation group_id="csiXF_bbCodeMap" display_order="206"/>
    </option>
    <option option_id="csiXF_bbCodeMap_lang" edit_format="radio" data_type="string" can_backup="1">
      <default_value>ru</default_value>
      <edit_format_params>en={xen:phrase csiXF_bbCodeMap_langEng}
ru={xen:phrase csiXF_bbCodeMap_langRus}</edit_format_params>
      <sub_options></sub_options>
      <relation group_id="csiXF_bbCodeMap" display_order="207"/>
    </option>
  </optiongroups>
  <permissions>
    <permission_groups/>
    <permissions/>
    <interface_groups/>
  </permissions>
  <phrases>
    <phrase title="csiXF_bbCodeMap_map" version_id="1" version_string="1.0.0"><![CDATA[Карта]]></phrase>
    <phrase title="csiXF_bbCodeMap_langEng" version_id="2" version_string="1.0.1"><![CDATA[Английский]]></phrase>
    <phrase title="csiXF_bbCodeMap_langRus" version_id="2" version_string="1.0.1"><![CDATA[Русский]]></phrase>
    <phrase title="option_csiXF_bbCodeMap_layers" version_id="2" version_string="1.0.1"><![CDATA[Слои]]></phrase>
    <phrase title="option_csiXF_bbCodeMap_layers_explain" version_id="1" version_string="1.0.0"><![CDATA[Слои, накладываемые на карту для отображения местности.
Название каждого слоя обрамляется одинарными кавычками, слои перечисляются через запятую. Для удобства каждый слой можно располагать на отдельной строке.
<br/><strong>Открытые системы:</strong> 'Cloudmade', 'CycleMap', 'Hike & Bike', 'Humanitarian', 'Landscape', 'MapBox', 'MapQuest Open', 'OpenMapSurfer Contour', 'OpenMapSurfer Grayscale', 'OpenMapSurfer', 'OpenStreetMap DE', 'OpenStreetMap FR', 'OpenStreetMap', 'Outdoors', 'Stamen Toner Lite', 'Stamen Toner', 'Stamen Watercolor', 'Transport'.
<br/><strong>Проприетарные системы:</strong> '2GIS', 'Esri Imagery', 'Esri Light Gray', 'Esri Street Map', 'Esri Topographic', 'Google Hybrid', 'Google Roads', 'Google Satellite', 'Google Terrain', 'National Geographic', 'Nokia Grey', 'Nokia Hybrid', 'Nokia Map', 'Nokia Satellite', 'Nokia Terrain', 'Yandex Hybrid', 'Yandex Map', 'Yandex People\'s Hybrid', 'Yandex People\'s Map', 'Yandex Satellite', 'Yandex Traffic Map'.]]></phrase>
    <phrase title="option_csiXF_bbCodeMap_layer2GIS" version_id="2" version_string="1.0.1"><![CDATA[Слой: 2GIS]]></phrase>
    <phrase title="option_csiXF_bbCodeMap_layer2GIS_explain" version_id="2" version_string="1.0.1"><![CDATA[Подключение карты 2GIS.]]></phrase>
    <phrase title="option_csiXF_bbCodeMap_layerBing" version_id="2" version_string="1.0.1"><![CDATA[Слой: Bing]]></phrase>
    <phrase title="option_csiXF_bbCodeMap_layerBing_explain" version_id="2" version_string="1.0.1"><![CDATA[Подключение карты Bing.]]></phrase>
    <phrase title="option_csiXF_bbCodeMap_layerEsri" version_id="2" version_string="1.0.1"><![CDATA[Слой: Esri]]></phrase>
    <phrase title="option_csiXF_bbCodeMap_layerEsri_explain" version_id="2" version_string="1.0.1"><![CDATA[Подключение карты Esri.]]></phrase>
    <phrase title="option_csiXF_bbCodeMap_layerGoogle" version_id="2" version_string="1.0.1"><![CDATA[Слой: Google]]></phrase>
    <phrase title="option_csiXF_bbCodeMap_layerGoogle_explain" version_id="2" version_string="1.0.1"><![CDATA[Подключение карты Google.]]></phrase>
    <phrase title="option_csiXF_bbCodeMap_layerNokia" version_id="2" version_string="1.0.1"><![CDATA[Слой: Nokia]]></phrase>
    <phrase title="option_csiXF_bbCodeMap_layerNokia_explain" version_id="2" version_string="1.0.1"><![CDATA[Подключение карты Nokia.]]></phrase>
    <phrase title="option_csiXF_bbCodeMap_layerYandex" version_id="2" version_string="1.0.1"><![CDATA[Слой: Yandex]]></phrase>
    <phrase title="option_csiXF_bbCodeMap_layerYandex_explain" version_id="2" version_string="1.0.1"><![CDATA[Подключение карты Yandex.]]></phrase>
    <phrase title="option_csiXF_bbCodeMap_defaultZoom" version_id="1" version_string="1.0.0"><![CDATA[Стартовый масштаб]]></phrase>
    <phrase title="option_csiXF_bbCodeMap_defaultZoom_explain" version_id="1" version_string="1.0.0"><![CDATA[Масштаб, принимаемый картой при загрузке страницы.]]></phrase>
    <phrase title="option_csiXF_bbCodeMap_defaultPosition" version_id="1" version_string="1.0.0"><![CDATA[Стартовая позиция]]></phrase>
    <phrase title="option_csiXF_bbCodeMap_defaultPosition_explain" version_id="1" version_string="1.0.0"><![CDATA[Позиция, принимаемая картой при загрузке страницы.]]></phrase>
    <phrase title="option_csiXF_bbCodeMap_viewWidth" version_id="1" version_string="1.0.0"><![CDATA[Ширина карты]]></phrase>
    <phrase title="option_csiXF_bbCodeMap_viewWidth_explain" version_id="1" version_string="1.0.0"><![CDATA[Ширина карты по умолчанию.]]></phrase>
    <phrase title="option_csiXF_bbCodeMap_viewHeight" version_id="1" version_string="1.0.0"><![CDATA[Высота карты]]></phrase>
    <phrase title="option_csiXF_bbCodeMap_viewHeight_explain" version_id="1" version_string="1.0.0"><![CDATA[Высота карты по умолчанию.]]></phrase>
    <phrase title="option_csiXF_bbCodeMap_fullViewHeight" version_id="1" version_string="1.0.0"><![CDATA[Высота расширенной карты]]></phrase>
    <phrase title="option_csiXF_bbCodeMap_fullViewHeight_explain" version_id="1" version_string="1.0.0"><![CDATA[Высота карты в режиме расширенного обзора.]]></phrase>
    <phrase title="option_csiXF_bbCodeMap_fullFromStart" version_id="1" version_string="1.0.0"><![CDATA[Расширенная карта при старте]]></phrase>
    <phrase title="option_csiXF_bbCodeMap_fullFromStart_explain" version_id="1" version_string="1.0.0"><![CDATA[Расширенный обзор карты при загрузке страницы.]]></phrase>
    <phrase title="option_csiXF_bbCodeMap_lang" version_id="1" version_string="1.0.0"><![CDATA[Локализация]]></phrase>
    <phrase title="option_csiXF_bbCodeMap_lang_explain" version_id="1" version_string="1.0.0"><![CDATA[Локализация интерфейса управления картой.]]></phrase>
    <phrase title="option_group_csiXF_bbCodeMap" version_id="1" version_string="1.0.0"><![CDATA[(CSI/XF/BBCODE) Карта]]></phrase>
    <phrase title="option_group_csiXF_bbCodeMap_description" version_id="1" version_string="1.0.0"><![CDATA[Отображение интерактивной карты в сообщениях.]]></phrase>
    <phrase title="custom_bb_code_map_title" version_id="1" version_string="1.0.0"><![CDATA[Карта]]></phrase>
    <phrase title="custom_bb_code_map_desc" version_id="1" version_string="1.0.0"><![CDATA[Отображение интерактивной карты в сообщениях.]]></phrase>
  </phrases>
  <route_prefixes/>
  <style_properties/>
  <templates>
    <template title="csiXF_bbCodeMap.init" version_id="2" version_string="1.0.1"><![CDATA[<xen:require css="csiXF_bbCodeMap_leaflet.css" />
<xen:require css="csiXF_bbCodeMap_leafletDraw.css" />
<xen:require css="csiXF_bbCodeMap_override.css" />
<xen:require js="js/csi/bbcode_map/leaflet.js" />
<xen:require js="js/csi/bbcode_map/leaflet.draw.js" />
<xen:require js="js/csi/bbcode_map/mapbbcode.js" />
<xen:require js="js/csi/bbcode_map/mapbbcode-config.js" />
<xen:require js="js/csi/bbcode_map/lang/{$xenOptions.csiXF_bbCodeMap_lang}.js" />

<xen:if is="{$xenOptions.csiXF_bbCodeMap_layer2GIS}">
  <xen:require js="js/csi/bbcode_map/proprietary/2GIS.js" />
</xen:if>
<xen:if is="{$xenOptions.csiXF_bbCodeMap_layerBing}">
  <xen:require js="js/csi/bbcode_map/proprietary/Bing.js" />
</xen:if>
<xen:if is="{$xenOptions.csiXF_bbCodeMap_layerEsri}">
  <xen:require js="js/csi/bbcode_map/proprietary/Esri.js" />
</xen:if>
<xen:if is="{$xenOptions.csiXF_bbCodeMap_layerGoogle}">
  <xen:require js="js/csi/bbcode_map/proprietary/Google.js" />
</xen:if>
<xen:if is="{$xenOptions.csiXF_bbCodeMap_layerNokia}">
  <xen:require js="js/csi/bbcode_map/proprietary/Nokia.js" />
</xen:if>
<xen:if is="{$xenOptions.csiXF_bbCodeMap_layerYandex}">
  <xen:require js="js/csi/bbcode_map/proprietary/Yandex.js" />
</xen:if>

<script type="text/javascript">
<!--
var mapBBcode = new MapBBCode({
  windowPath: '/js/csi/bbcode_map/',
  layers: [{xen:raw $xenOptions.csiXF_bbCodeMap_layers}],
  defaultZoom: {$xenOptions.csiXF_bbCodeMap_defaultZoom},
  defaultPosition: [{$xenOptions.csiXF_bbCodeMap_defaultPosition}],
  viewWidth: {$xenOptions.csiXF_bbCodeMap_viewWidth},
  viewHeight: {$xenOptions.csiXF_bbCodeMap_viewHeight},
  fullViewHeight: {$xenOptions.csiXF_bbCodeMap_fullViewHeight},
  fullFromStart: {$xenOptions.csiXF_bbCodeMap_fullFromStart},
  preferStandardLayerSwitcher: true
});
//-->
</script>]]></template>
    <template title="csiXF_bbCodeMap_tag_map" version_id="1" version_string="1.0.0"><![CDATA[<div class="bbCodeBlock csiXF_bbCodeMap">
  <div class="attribution type">{xen:phrase csiXF_bbCodeMap_map}</div>
  <div class="mapContainer">
    <div class="map">
      <div id="map-{xen:raw $mapId}">{xen:raw $content}</div>
      <script type="text/javascript">if(mapBBcode) mapBBcode.show('map-{xen:raw $mapId}');</script>
    </div>
  </div>
</div>]]></template>
    <template title="csiXF_bbCodeMap_leaflet.css" version_id="1" version_string="1.0.0"><![CDATA[/* required styles */

.leaflet-map-pane,
.leaflet-tile,
.leaflet-marker-icon,
.leaflet-marker-shadow,
.leaflet-tile-pane,
.leaflet-tile-container,
.leaflet-overlay-pane,
.leaflet-shadow-pane,
.leaflet-marker-pane,
.leaflet-popup-pane,
.leaflet-overlay-pane svg,
.leaflet-zoom-box,
.leaflet-image-layer,
.leaflet-layer {
  position: absolute;
  left: 0;
  top: 0;
  }
.leaflet-container {
  overflow: hidden;
  -ms-touch-action: none;
  touch-action: none;
  }
.leaflet-tile,
.leaflet-marker-icon,
.leaflet-marker-shadow {
  -webkit-user-select: none;
     -moz-user-select: none;
          user-select: none;
  -webkit-user-drag: none;
  }
.leaflet-marker-icon,
.leaflet-marker-shadow {
  display: block;
  }
/* map is broken in FF if you have max-width: 100% on tiles */
.leaflet-container img {
  max-width: none !important;
  }
/* stupid Android 2 doesn't understand "max-width: none" properly */
.leaflet-container img.leaflet-image-layer {
  max-width: 15000px !important;
  }
.leaflet-tile {
  filter: inherit;
  visibility: hidden;
  }
.leaflet-tile-loaded {
  visibility: inherit;
  }
.leaflet-zoom-box {
  width: 0;
  height: 0;
  }
/* workaround for https://bugzilla.mozilla.org/show_bug.cgi?id=888319 */
.leaflet-overlay-pane svg {
  -moz-user-select: none;
  }

.leaflet-tile-pane    { z-index: 2; }
.leaflet-objects-pane { z-index: 3; }
.leaflet-overlay-pane { z-index: 4; }
.leaflet-shadow-pane  { z-index: 5; }
.leaflet-marker-pane  { z-index: 6; }
.leaflet-popup-pane   { z-index: 7; }

.leaflet-vml-shape {
  width: 1px;
  height: 1px;
  }
.lvml {
  behavior: url(#default#VML);
  display: inline-block;
  position: absolute;
  }


/* control positioning */

.leaflet-control {
  position: relative;
  z-index: 7;
  pointer-events: auto;
  }
.leaflet-top,
.leaflet-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
  }
.leaflet-top {
  top: 0;
  }
.leaflet-right {
  right: 0;
  }
.leaflet-bottom {
  bottom: 0;
  }
.leaflet-left {
  left: 0;
  }
.leaflet-control {
  float: left;
  clear: both;
  }
.leaflet-right .leaflet-control {
  float: right;
  }
.leaflet-top .leaflet-control {
  margin-top: 10px;
  }
.leaflet-bottom .leaflet-control {
  margin-bottom: 10px;
  }
.leaflet-left .leaflet-control {
  margin-left: 10px;
  }
.leaflet-right .leaflet-control {
  margin-right: 10px;
  }


/* zoom and fade animations */

.leaflet-fade-anim .leaflet-tile,
.leaflet-fade-anim .leaflet-popup {
  opacity: 0;
  -webkit-transition: opacity 0.2s linear;
     -moz-transition: opacity 0.2s linear;
       -o-transition: opacity 0.2s linear;
          transition: opacity 0.2s linear;
  }
.leaflet-fade-anim .leaflet-tile-loaded,
.leaflet-fade-anim .leaflet-map-pane .leaflet-popup {
  opacity: 1;
  }

.leaflet-zoom-anim .leaflet-zoom-animated {
  -webkit-transition: -webkit-transform 0.25s cubic-bezier(0,0,0.25,1);
     -moz-transition:    -moz-transform 0.25s cubic-bezier(0,0,0.25,1);
       -o-transition:      -o-transform 0.25s cubic-bezier(0,0,0.25,1);
          transition:         transform 0.25s cubic-bezier(0,0,0.25,1);
  }
.leaflet-zoom-anim .leaflet-tile,
.leaflet-pan-anim .leaflet-tile,
.leaflet-touching .leaflet-zoom-animated {
  -webkit-transition: none;
     -moz-transition: none;
       -o-transition: none;
          transition: none;
  }

.leaflet-zoom-anim .leaflet-zoom-hide {
  visibility: hidden;
  }


/* cursors */

.leaflet-clickable {
  cursor: pointer;
  }
.leaflet-container {
  cursor: -webkit-grab;
  cursor:    -moz-grab;
  }
.leaflet-popup-pane,
.leaflet-control {
  cursor: auto;
  }
.leaflet-dragging .leaflet-container,
.leaflet-dragging .leaflet-clickable {
  cursor: move;
  cursor: -webkit-grabbing;
  cursor:    -moz-grabbing;
  }


/* visual tweaks */

.leaflet-container {
  background: #ddd;
  outline: 0;
  }
.leaflet-container a {
  color: #0078A8;
  }
.leaflet-container a.leaflet-active {
  outline: 2px solid orange;
  }
.leaflet-zoom-box {
  border: 2px dotted #38f;
  background: rgba(255,255,255,0.5);
  }


/* general typography */
.leaflet-container {
  font: 12px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif;
  }


/* general toolbar styles */

.leaflet-bar {
  box-shadow: 0 1px 5px rgba(0,0,0,0.65);
  border-radius: 4px;
  }
.leaflet-bar a,
.leaflet-bar a:hover {
  background-color: #fff;
  border-bottom: 1px solid #ccc;
  width: 26px;
  height: 26px;
  line-height: 26px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: black;
  }
.leaflet-bar a,
.leaflet-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
  }
.leaflet-bar a:hover {
  background-color: #f4f4f4;
  }
.leaflet-bar a:first-child {
  border-top-left-radius: 4px;
  border-top-right-radius: 4px;
  }
.leaflet-bar a:last-child {
  border-bottom-left-radius: 4px;
  border-bottom-right-radius: 4px;
  border-bottom: none;
  }
.leaflet-bar a.leaflet-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
  }

.leaflet-touch .leaflet-bar a {
  width: 30px;
  height: 30px;
  line-height: 30px;
  }


/* zoom control */

.leaflet-control-zoom-in,
.leaflet-control-zoom-out {
  font: bold 18px 'Lucida Console', Monaco, monospace;
  text-indent: 1px;
  }
.leaflet-control-zoom-out {
  font-size: 20px;
  }

.leaflet-touch .leaflet-control-zoom-in {
  font-size: 22px;
  }
.leaflet-touch .leaflet-control-zoom-out {
  font-size: 24px;
  }


/* layers control */

.leaflet-control-layers {
  box-shadow: 0 1px 5px rgba(0,0,0,0.4);
  background: #fff;
  border-radius: 5px;
  }
.leaflet-control-layers-toggle {
  background-image: url(images/layers.png);
  width: 36px;
  height: 36px;
  }
.leaflet-retina .leaflet-control-layers-toggle {
  background-image: url(images/layers-2x.png);
  background-size: 26px 26px;
  }
.leaflet-touch .leaflet-control-layers-toggle {
  width: 44px;
  height: 44px;
  }
.leaflet-control-layers .leaflet-control-layers-list,
.leaflet-control-layers-expanded .leaflet-control-layers-toggle {
  display: none;
  }
.leaflet-control-layers-expanded .leaflet-control-layers-list {
  display: block;
  position: relative;
  }
.leaflet-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #333;
  background: #fff;
  }
.leaflet-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
  }
.leaflet-control-layers label {
  display: block;
  }
.leaflet-control-layers-separator {
  height: 0;
  border-top: 1px solid #ddd;
  margin: 5px -10px 5px -6px;
  }


/* attribution and scale controls */

.leaflet-container .leaflet-control-attribution {
  background: #fff;
  background: rgba(255, 255, 255, 0.7);
  margin: 0;
  }
.leaflet-control-attribution,
.leaflet-control-scale-line {
  padding: 0 5px;
  color: #333;
  }
.leaflet-control-attribution a {
  text-decoration: none;
  }
.leaflet-control-attribution a:hover {
  text-decoration: underline;
  }
.leaflet-container .leaflet-control-attribution,
.leaflet-container .leaflet-control-scale {
  font-size: 11px;
  }
.leaflet-left .leaflet-control-scale {
  margin-left: 5px;
  }
.leaflet-bottom .leaflet-control-scale {
  margin-bottom: 5px;
  }
.leaflet-control-scale-line {
  border: 2px solid #777;
  border-top: none;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -moz-box-sizing: content-box;
       box-sizing: content-box;

  background: #fff;
  background: rgba(255, 255, 255, 0.5);
  }
.leaflet-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
  }
.leaflet-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
  }

.leaflet-touch .leaflet-control-attribution,
.leaflet-touch .leaflet-control-layers,
.leaflet-touch .leaflet-bar {
  box-shadow: none;
  }
.leaflet-touch .leaflet-control-layers,
.leaflet-touch .leaflet-bar {
  border: 2px solid rgba(0,0,0,0.2);
  background-clip: padding-box;
  }


/* popup */

.leaflet-popup {
  position: absolute;
  text-align: center;
  }
.leaflet-popup-content-wrapper {
  padding: 1px;
  text-align: left;
  border-radius: 12px;
  }
.leaflet-popup-content {
  margin: 13px 19px;
  line-height: 1.4;
  }
.leaflet-popup-content p {
  margin: 18px 0;
  }
.leaflet-popup-tip-container {
  margin: 0 auto;
  width: 40px;
  height: 20px;
  position: relative;
  overflow: hidden;
  }
.leaflet-popup-tip {
  width: 17px;
  height: 17px;
  padding: 1px;

  margin: -10px auto 0;

  -webkit-transform: rotate(45deg);
     -moz-transform: rotate(45deg);
      -ms-transform: rotate(45deg);
       -o-transform: rotate(45deg);
          transform: rotate(45deg);
  }
.leaflet-popup-content-wrapper,
.leaflet-popup-tip {
  background: white;

  box-shadow: 0 3px 14px rgba(0,0,0,0.4);
  }
.leaflet-container a.leaflet-popup-close-button {
  position: absolute;
  top: 0;
  right: 0;
  padding: 4px 4px 0 0;
  text-align: center;
  width: 18px;
  height: 14px;
  font: 16px/14px Tahoma, Verdana, sans-serif;
  color: #c3c3c3;
  text-decoration: none;
  font-weight: bold;
  background: transparent;
  }
.leaflet-container a.leaflet-popup-close-button:hover {
  color: #999;
  }
.leaflet-popup-scrolled {
  overflow: auto;
  border-bottom: 1px solid #ddd;
  border-top: 1px solid #ddd;
  }

.leaflet-oldie .leaflet-popup-content-wrapper {
  zoom: 1;
  }
.leaflet-oldie .leaflet-popup-tip {
  width: 24px;
  margin: 0 auto;

  -ms-filter: "progid:DXImageTransform.Microsoft.Matrix(M11=0.70710678, M12=0.70710678, M21=-0.70710678, M22=0.70710678)";
  filter: progid:DXImageTransform.Microsoft.Matrix(M11=0.70710678, M12=0.70710678, M21=-0.70710678, M22=0.70710678);
  }
.leaflet-oldie .leaflet-popup-tip-container {
  margin-top: -1px;
  }

.leaflet-oldie .leaflet-control-zoom,
.leaflet-oldie .leaflet-control-layers,
.leaflet-oldie .leaflet-popup-content-wrapper,
.leaflet-oldie .leaflet-popup-tip {
  border: 1px solid #999;
  }


/* div icon */

.leaflet-div-icon {
  background: #fff;
  border: 1px solid #666;
  }]]></template>
    <template title="csiXF_bbCodeMap_leafletDraw.css" version_id="1" version_string="1.0.0"><![CDATA[/* ================================================================== */
/* Toolbars
/* ================================================================== */

.leaflet-draw-section {
  position: relative;
}

.leaflet-draw-toolbar {
  margin-top: 12px;
}

.leaflet-draw-toolbar-top {
  margin-top: 0;
}

.leaflet-draw-toolbar-notop a:first-child {
  border-top-right-radius: 0;
}

.leaflet-draw-toolbar-nobottom a:last-child {
  border-bottom-right-radius: 0;
}

.leaflet-draw-toolbar a {
  background-image: url('images/spritesheet.png');
  background-repeat: no-repeat;
}

.leaflet-retina .leaflet-draw-toolbar a {
  background-image: url('images/spritesheet-2x.png');
  background-size: 270px 30px;
}

.leaflet-draw a {
  display: block;
  text-align: center;
  text-decoration: none;
}

/* ================================================================== */
/* Toolbar actions menu
/* ================================================================== */

.leaflet-draw-actions {
  display: none;
  list-style: none;
  margin: 0;
  padding: 0;
  position: absolute;
  left: 26px; /* leaflet-draw-toolbar.left + leaflet-draw-toolbar.width */
  top: 0;
  white-space: nowrap;
}

.leaflet-touch .leaflet-draw-actions {
  left: 32px;
}

.leaflet-right .leaflet-draw-actions {
  right:26px;
  left:auto;
}

.leaflet-touch .leaflet-right .leaflet-draw-actions {
  right:32px;
  left:auto;
}

.leaflet-draw-actions li {
  display: inline-block;
}

.leaflet-draw-actions li:first-child a {
  border-left: none;
}

.leaflet-draw-actions li:last-child a {
  -webkit-border-radius: 0 4px 4px 0;
          border-radius: 0 4px 4px 0;
}

.leaflet-right .leaflet-draw-actions li:last-child a {
  -webkit-border-radius: 0;
          border-radius: 0;
}

.leaflet-right .leaflet-draw-actions li:first-child a {
  -webkit-border-radius: 4px 0 0 4px;
          border-radius: 4px 0 0 4px;
}

.leaflet-draw-actions a {
  background-color: #919187;
  border-left: 1px solid #AAA;
  color: #FFF;
  font: 11px/19px "Helvetica Neue", Arial, Helvetica, sans-serif;
  line-height: 28px;
  text-decoration: none;
  padding-left: 10px;
  padding-right: 10px;
  height: 28px;
}

.leaflet-touch .leaflet-draw-actions a {
  font-size: 12px;
  line-height: 30px;
  height: 30px;
}

.leaflet-draw-actions-bottom {
  margin-top: 0;
}

.leaflet-draw-actions-top {
  margin-top: 1px;
}

.leaflet-draw-actions-top a,
.leaflet-draw-actions-bottom a {
  height: 27px;
  line-height: 27px;
}

.leaflet-draw-actions a:hover {
  background-color: #A0A098;
}

.leaflet-draw-actions-top.leaflet-draw-actions-bottom a {
  height: 26px;
  line-height: 26px;
}

/* ================================================================== */
/* Draw toolbar
/* ================================================================== */

.leaflet-draw-toolbar .leaflet-draw-draw-polyline {
  background-position: -2px -2px;
}

.leaflet-touch .leaflet-draw-toolbar .leaflet-draw-draw-polyline {
  background-position: 0 -1px;
}

.leaflet-draw-toolbar .leaflet-draw-draw-polygon {
  background-position: -31px -2px;
}

.leaflet-touch .leaflet-draw-toolbar .leaflet-draw-draw-polygon {
  background-position: -29px -1px;
}

.leaflet-draw-toolbar .leaflet-draw-draw-rectangle {
  background-position: -62px -2px;
}

.leaflet-touch .leaflet-draw-toolbar .leaflet-draw-draw-rectangle {
  background-position: -60px -1px;
}

.leaflet-draw-toolbar .leaflet-draw-draw-circle {
  background-position: -92px -2px;
}

.leaflet-touch .leaflet-draw-toolbar .leaflet-draw-draw-circle {
  background-position: -90px -1px;
}

.leaflet-draw-toolbar .leaflet-draw-draw-marker {
  background-position: -122px -2px;
}

.leaflet-touch .leaflet-draw-toolbar .leaflet-draw-draw-marker {
  background-position: -120px -1px;
}

/* ================================================================== */
/* Edit toolbar
/* ================================================================== */

.leaflet-draw-toolbar .leaflet-draw-edit-edit {
  background-position: -152px -2px;
}

.leaflet-touch .leaflet-draw-toolbar .leaflet-draw-edit-edit {
  background-position: -150px -1px;
}

.leaflet-draw-toolbar .leaflet-draw-edit-remove {
  background-position: -182px -2px;
}

.leaflet-touch .leaflet-draw-toolbar .leaflet-draw-edit-remove {
  background-position: -180px -1px;
}

.leaflet-draw-toolbar .leaflet-draw-edit-edit.leaflet-disabled {
  background-position: -212px -2px;
}

.leaflet-touch .leaflet-draw-toolbar .leaflet-draw-edit-edit.leaflet-disabled {
  background-position: -210px -1px;
}

.leaflet-draw-toolbar .leaflet-draw-edit-remove.leaflet-disabled {
  background-position: -242px -2px;
}

.leaflet-touch .leaflet-draw-toolbar .leaflet-draw-edit-remove.leaflet-disabled {
  background-position: -240px -2px;
}

/* ================================================================== */
/* Drawing styles
/* ================================================================== */

.leaflet-mouse-marker {
  background-color: #fff;
  cursor: crosshair;
}

.leaflet-draw-tooltip {
  background: rgb(54, 54, 54);
  background: rgba(0, 0, 0, 0.5);
  border: 1px solid transparent;
  -webkit-border-radius: 4px;
          border-radius: 4px;
  color: #fff;
  font: 12px/18px "Helvetica Neue", Arial, Helvetica, sans-serif;
  margin-left: 20px;
  margin-top: -21px;
  padding: 4px 8px;
  position: absolute;
  visibility: hidden;
  white-space: nowrap;
  z-index: 6;
}

.leaflet-draw-tooltip:before {
  border-right: 6px solid black;
  border-right-color: rgba(0, 0, 0, 0.5);
  border-top: 6px solid transparent;
  border-bottom: 6px solid transparent;
  content: "";
  position: absolute;
  top: 7px;
  left: -7px;
}

.leaflet-error-draw-tooltip {
  background-color: #F2DEDE;
  border: 1px solid #E6B6BD;
  color: #B94A48;
}

.leaflet-error-draw-tooltip:before {
  border-right-color: #E6B6BD;
}

.leaflet-draw-tooltip-single {
  margin-top: -12px
}

.leaflet-draw-tooltip-subtext {
  color: #f8d5e4;
}

.leaflet-draw-guide-dash {
  font-size: 1%;
  opacity: 0.6;
  position: absolute;
  width: 5px;
  height: 5px;
}

/* ================================================================== */
/* Edit styles
/* ================================================================== */

.leaflet-edit-marker-selected {
  background: rgba(254, 87, 161, 0.1);
  border: 4px dashed rgba(254, 87, 161, 0.6);
  -webkit-border-radius: 4px;
          border-radius: 4px;
  box-sizing: content-box;
}

.leaflet-edit-move {
  cursor: move;
}

.leaflet-edit-resize {
  cursor: pointer;
}

/* ================================================================== */
/* Old IE styles
/* ================================================================== */

.leaflet-oldie .leaflet-draw-toolbar {
  border: 1px solid #999;
}]]></template>
    <template title="csiXF_bbCodeMap_override.css" version_id="1" version_string="1.0.0"><![CDATA[/* make some leaflet and leaflet.draw CSS declarations stronger to override external engine's styles */

/* tiles */

.leaflet-container div img {
  padding: 0;
  margin: 0;
}

.leaflet-tile {
  padding: 0 !important;
  margin: 0 !important;
}

/* main panes */

.leaflet-container.leaflet-fade-anim,
.leaflet-container .leaflet-map-pane,
.leaflet-map-pane .leaflet-tile-pane,
.leaflet-map-pane .leaflet-tile-pane div,
.leaflet-map-pane .leaflet-objects-pane,
.leaflet-objects-pane .leaflet-marker-pane,
.leaflet-objects-pane .leaflet-shadow-pane,
.leaflet-objects-pane .leaflet-overlay-pane,
.leaflet-overlay-pane .leaflet-vml-container,
.leaflet-objects-pane .leaflet-popup-pane {
  padding: 0;
  margin: 0;
}

/* control margins */

.leaflet-control-container .leaflet-control,
.leaflet-control-container .leaflet-top,
.leaflet-control-container .leaflet-bottom,
.leaflet-control-container .leaflet-right {
  margin: 0;
  padding: 0;
}

/* link and text colors */

.leaflet-container div a {
  color: #0078A8;
}

.leaflet-container .leaflet-bar a {
  color: black;
  text-decoration: none;
}

.leaflet-control-container div,
.leaflet-objects-pane .leaflet-marker-pane div,
.leaflet-objects-pane .leaflet-popup-pane div {
  color: black;
}

/* layers control */

.leaflet-control-layers.leaflet-control div {
  padding: 0;
  margin: 0;
}

.leaflet-control-layers.leaflet-control .leaflet-control-layers-separator {
  margin: 5px -10px 5px -6px;
  border-top: 1px solid #ddd;
}

.leaflet-control-layers.leaflet-control.leaflet-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #333;
  background: #fff;
}

/* attribution */

.leaflet-control-container .leaflet-control-attribution {
  color: #333333;
  padding: 0 5px;
}

/* popups */

.leaflet-popup-pane .leaflet-popup {
  margin: 0;
  padding: 0;
}

.leaflet-container .leaflet-popup-tip {
  margin: -10px auto 0;
  padding: 1px;
}

.leaflet-container .leaflet-popup-tip-container {
  padding: 0;
  margin: 0 auto;
}

.leaflet-popup .leaflet-popup-content-wrapper {
  margin: 0;
  padding: 1px;
}

.leaflet-popup .leaflet-popup-content {
  padding: 0;
  margin: 13px 19px;
}

.leaflet-popup .leaflet-popup-content div {
  padding: 0;
  margin: 0;
}

/* leaflet.draw */

.leaflet-draw .leaflet-draw-section,
.leaflet-draw .leaflet-bar,
.leaflet-overlay-pane .leaflet-draw-guides,
.leaflet-draw-guides .leaflet-draw-guide-dash {
  margin: 0;
  padding: 0;
}

.leaflet-draw .leaflet-draw-actions a {
  background-color: #919187;
  color: white;
}

.leaflet-container .leaflet-popup-pane .leaflet-draw-tooltip {
  color: white;
  margin: -21px 0 0 20px;
  padding: 4px 8px;
  border: 1px solid transparent;
}

.leaflet-container .leaflet-popup-pane .leaflet-draw-tooltip-single {
  margin-top: -12px;
}

.leaflet-marker-pane .leaflet-div-icon {
  padding: 0;
  margin: 0;
  border: 1px solid #666666;
}

/* original CSS goes here */
]]></template>
  </templates>
  <public_template_modifications>
    <modification template="PAGE_CONTAINER" modification_key="csiXF_bbCodeMapJs" description="Добавление шаблона &quot;csiXF_bbCodeMap.init&quot; - инициализация карты" execution_order="10" enabled="1" action="str_replace">
      <find><![CDATA[<xen:include template="page_container_js_head" />]]></find>
      <replace><![CDATA[$0
<xen:include template="csiXF_bbCodeMap.init" />]]></replace>
    </modification>
  </public_template_modifications>
  <bb_code_media_sites/>
  <bb_codes>
    <bb_code bb_code_id="map" bb_code_mode="callback" has_option="no" callback_class="CSI_BbCodeMap_BbCode_Formatter_Base" callback_method="getBbCodeMap" option_regex="" trim_lines_after="1" plain_children="1" disable_smilies="1" disable_nl2br="1" disable_autolink="1" allow_empty="0" allow_signature="0" editor_icon_url="" sprite_mode="0" sprite_params_x="" sprite_params_y="" active="1">
      <replace_html><![CDATA[]]></replace_html>
      <replace_html_email><![CDATA[]]></replace_html_email>
      <replace_text><![CDATA[]]></replace_text>
      <example><![CDATA[[map]59.9342,30.3367(S); 59.4366,24.7529(F); 59.377,28.204(Погранконтроль); 59.934,30.337 59.718,30.037 59.39,28.532 59.372,27.444 59.428,26.807 59.367,26.433 59.469,26.016 59.437,24.753[/map]]]></example>
    </bb_code>
  </bb_codes>
</addon>
